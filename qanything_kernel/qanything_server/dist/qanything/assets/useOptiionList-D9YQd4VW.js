import{m as K,a4 as W,a as O,r as j}from"./RightOutlined-DDskqLVR.js";import{Z as P,c as X,_ as R,$ as Q,r as u,af as E,a1 as S}from"./index-De9HRGdb.js";import{u as U,g as G,r as H,f as J,c as V}from"./utils-CnoIDJDJ.js";import{g as z}from"./index-QFS3TB7J.js";var _="[object Symbol]";function $(e){return typeof e=="symbol"||K(e)&&W(e)==_}var ee=/\s/;function se(e){for(var o=e.length;o--&&ee.test(e.charAt(o)););return o}var te=/^\s+/;function ne(e){return e&&e.slice(0,se(e)+1).replace(te,"")}var q=NaN,ae=/^[-+]0x[0-9a-f]+$/i,oe=/^0b[01]+$/i,re=/^0o[0-7]+$/i,le=parseInt;function Y(e){if(typeof e=="number")return e;if($(e))return q;if(O(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=O(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=ne(e);var n=oe.test(e);return n||re.test(e)?le(e.slice(2),n?2:8):ae.test(e)?q:+e}var D=function(){return j.Date.now()},ie="Expected a function",ce=Math.max,ue=Math.min;function pe(e,o,n){var v,g,i,c,a,d,h=0,A=!1,p=!1,L=!0;if(typeof e!="function")throw new TypeError(ie);o=Y(o)||0,O(n)&&(A=!!n.leading,p="maxWait"in n,i=p?ce(Y(n.maxWait)||0,o):i,L="trailing"in n?!!n.trailing:L);function f(r){var s=v,b=g;return v=g=void 0,h=r,c=e.apply(b,s),c}function l(r){return h=r,a=setTimeout(C,o),A?f(r):c}function w(r){var s=r-d,b=r-h,x=o-s;return p?ue(x,i-b):x}function m(r){var s=r-d,b=r-h;return d===void 0||s>=o||s<0||p&&b>=i}function C(){var r=D();if(m(r))return T(r);a=setTimeout(C,w(r))}function T(r){return a=void 0,L&&v?f(r):(v=g=void 0,c)}function I(){a!==void 0&&clearTimeout(a),h=0,v=d=g=a=void 0}function F(){return a===void 0?c:T(D())}function t(){var r=D(),s=m(r);if(v=arguments,g=this,d=r,s){if(a===void 0)return l(d);if(p)return clearTimeout(a),a=setTimeout(C,o),f(d)}return a===void 0&&(a=setTimeout(C,o)),c}return t.cancel=I,t.flush=F,t}const xe=["xxxl","xxl","xl","lg","md","sm","xs"],de=e=>({xs:`(max-width: ${e.screenXSMax}px)`,sm:`(min-width: ${e.screenSM}px)`,md:`(min-width: ${e.screenMD}px)`,lg:`(min-width: ${e.screenLG}px)`,xl:`(min-width: ${e.screenXL}px)`,xxl:`(min-width: ${e.screenXXL}px)`,xxxl:`{min-width: ${e.screenXXXL}px}`});function ye(){const[,e]=P();return X(()=>{const o=de(e.value),n=new Map;let v=-1,g={};return{matchHandlers:{},dispatch(i){return g=i,n.forEach(c=>c(g)),n.size>=1},subscribe(i){return n.size||this.register(),v+=1,n.set(v,i),i(g),v},unsubscribe(i){n.delete(i),n.size||this.unregister()},unregister(){Object.keys(o).forEach(i=>{const c=o[i],a=this.matchHandlers[c];a==null||a.mql.removeListener(a==null?void 0:a.listener)}),n.clear()},register(){Object.keys(o).forEach(i=>{const c=o[i],a=h=>{let{matches:A}=h;this.dispatch(R(R({},g),{[i]:A}))},d=window.matchMedia(c);d.addListener(a),this.matchHandlers[c]={mql:d,listener:a},a(d)})},responsiveMap:o}})}var fe=(e=>(e[e.success=0]="success",e[e.parsed=1]="parsed",e[e.error=2]="error",e[e.filebig=3]="filebig",e[e.loading=4]="loading",e[e.failed=5]="failed",e))(fe||{}),M=(e=>(e[e.initing=0]="initing",e[e.default=1]="default",e[e.normal=2]="normal",e[e.optionlist=3]="optionlist",e))(M||{});const ge=z().common,he=Q("knowledgeBase",()=>{const e=u(""),o=f=>{e.value=f},n=u([]),v=f=>{n.value=f},g=u(""),i=f=>{g.value=f},c=u([]),a=f=>{c.value=f},d=u(M.initing),h=f=>{d.value=f},A=u(!1);return{currentId:e,setCurrentId:o,knowledgeBaseList:c,setKnowledgeBaseList:a,showDeleteModal:A,setShowDeleteModal:f=>{A.value=f},showDefault:d,setDefault:h,getList:async()=>{var f;try{const l=await U.kbList();if(+l.code==200)if(((f=l==null?void 0:l.data)==null?void 0:f.length)>0){const w=l.data.filter(m=>!/.*_FAQ$/.test(m.kb_name));a(w),h(M.normal),n.value.length||n.value.push(w[0].kb_id)}else h(M.default)}catch(l){E.error(l.msg||ge.error)}},currentKbName:g,setCurrentKbName:i,selectList:n,setSelectList:v}}),Z=z().home,ve=z().common,Le=Q("knowledgeModal",()=>{const e=u(!1),o=l=>{e.value=l},n=u(!1),v=l=>{n.value=l},g=u(Z.upload),i=l=>{g.value=l},c=u(""),a=l=>{c.value=l},d=u([]),h=l=>{d.value=l},A=u([]);return{modalVisible:e,setModalVisible:o,urlModalVisible:n,setUrlModalVisible:v,knowledgeName:c,setKnowledgeName:a,fileList:d,setFileList:h,urlList:A,setUrlList:l=>{A.value=l},modalTitle:g,setModalTitle:i,$reset:()=>{e.value=!1,g.value=Z.upload,c.value="",d.value=[],A.value=[]},getFileList:async l=>{try{const w=await U.fileList({kb_id:l});w.code==200&&(w.data.details.forEach(m=>{m.errorText=G(m)}),h(w.data.details))}catch(w){console.log(w),E.error(w.msg||ve.error)}}}}),Te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",{currentId:k}=S(he()),Ce=Q("option-list",()=>{const e=u([]),o=t=>{e.value=t},n=u([]),v=t=>{n.value=t},g=u(0),i=t=>{g.value=t},c=u(1),a=t=>{c.value=t},d=u(!1),h=t=>{d.value=t},A=u("upload"),p=t=>{A.value=t},L=u(null),f=t=>{L.value=t},l=u(!1),w=t=>{l.value=t},m=u(null),C=async()=>{try{m.value&&clearTimeout(m.value);const t=await H(await U.fileList({kb_id:k.value}));o([]),t==null||t.details.forEach((s,b)=>{e.value.push({id:1e4+b,fileId:s==null?void 0:s.file_id,fileIdName:s==null?void 0:s.file_name,status:s==null?void 0:s.status,bytes:J((s==null?void 0:s.bytes)||0),createtime:V(s==null?void 0:s.timestamp),errortext:(s==null?void 0:s.status)==="gray"||(s==null?void 0:s.status)==="green"?"":s==null?void 0:s.msg})});const r=t==null?void 0:t.details.some(s=>s.status==="gray");console.log(r),r?(console.log("有解析中的  10后再次请求"),m.value=setTimeout(()=>{clearTimeout(m.value),C()},1e4)):console.log("全部解析完成")}catch(t){console.log(t),E.error(t.msg||"获取知识库详情失败")}},T=u(null),I=async()=>{try{T.value&&clearTimeout(T.value),h(!0);const t=await H(await U.fileList({kb_id:k.value+"_FAQ"}));if(v([]),!(t!=null&&t.details)){console.log("res?.details",t==null?void 0:t.details),i(0),h(!1);return}t==null||t.details.forEach(async(s,b)=>{n.value.push({id:1e4+b,faqId:s==null?void 0:s.file_id,question:s==null?void 0:s.question,answer:s==null?void 0:s.answer,status:s==null?void 0:s.status,bytes:`${s==null?void 0:s.content_length}字符`,createtime:V(s==null?void 0:s.timestamp),picUrlList:[]}),s!=null&&s.picUrlList&&await F(s==null?void 0:s.picUrlList).then(x=>{console.log("成功获取图片文件:",x);const y=s==null?void 0:s.picUrlList.map((N,B)=>({uid:-B,name:"image",status:"done",url:N,originFileObj:x[B]}));n.value[b].picUrlList=y}).catch(x=>{console.error("获取图片文件出错:",x)})});const r=t==null?void 0:t.details.some(s=>s.status==="gray");console.log("flag",r),r?(console.log("有解析中的  5s后再次请求"),T.value=setTimeout(()=>{clearTimeout(T.value),I()},5e3)):console.log("全部解析完成")}catch(t){console.log(t),E.error(t.msg||"获取faq列表失败")}h(!1)};function F(t){const r=t.map(s=>new Promise((b,x)=>{fetch(s).then(y=>y.blob()).then(y=>{const N=s.substring(s.lastIndexOf("/")+1),B=new File([y],N,{type:y.type});b(B)}).catch(y=>{console.error("Error fetching the image:",y),x(y)})}));return Promise.all(r)}return{dataSource:e,setDataSource:o,faqList:n,setFaqList:v,getDetails:C,timer:m,editQaSet:L,setEditQaSet:f,editModalVisible:l,setEditModalVisible:w,faqTimer:T,getFaqList:I,faqType:A,setFaqType:p,total:g,setTotal:i,pageNum:c,setPageNum:a,loading:d,setLoading:h}},{persist:{storage:sessionStorage}});export{Te as _,he as a,Le as b,Ce as c,pe as d,fe as f,$ as i,M as p,xe as r,Y as t,ye as u};
