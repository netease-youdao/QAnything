import{u as I,g as J,r as Q,f as G,c as V}from"./utils-DMQccJQa.js";import{a2 as E,r as o,w as S,G as k,x as W}from"./index-vLLWhXaM.js";import{g as M}from"./index-CXmHDMVd.js";var _=(a=>(a[a.success=0]="success",a[a.parsed=1]="parsed",a[a.error=2]="error",a[a.filebig=3]="filebig",a[a.loading=4]="loading",a[a.failed=5]="failed",a))(_||{}),D=(a=>(a[a.initing=0]="initing",a[a.default=1]="default",a[a.normal=2]="normal",a[a.optionlist=3]="optionlist",a))(D||{});const X=M().common,$=E("knowledgeBase",()=>{const a=o(""),p=c=>{a.value=c};S(()=>a.value,()=>{console.log("current",a.value)});const l=o([]),b=c=>{l.value=c},g=o(""),U=c=>{g.value=c},h=o([]),f=c=>{h.value=c},i=o(D.initing),v=c=>{i.value=c},w=o(!1);return{currentId:a,setCurrentId:p,knowledgeBaseList:h,setKnowledgeBaseList:f,showDeleteModal:w,setShowDeleteModal:c=>{w.value=c},showDefault:i,setDefault:v,getList:async()=>{var c,n;try{const r=await I.kbList();if(+r.code==200)if(((c=r==null?void 0:r.data)==null?void 0:c.length)>0){const u=r.data.filter(m=>!/.*_FAQ$/.test(m.kb_name));f(u),v(D.normal),l.value.length||l.value.push((n=u[0])==null?void 0:n.kb_id)}else f([]),v(D.default)}catch(r){k.error(r.msg||X.error)}},currentKbName:g,setCurrentKbName:U,selectList:l,setSelectList:b}},{persist:{storage:localStorage}}),P=M().home,ee=M().common,oe=E("knowledgeModal",()=>{const a=o(!1),p=n=>{a.value=n},l=o(!1),b=n=>{l.value=n},g=o(P.upload),U=n=>{g.value=n},h=o(""),f=n=>{h.value=n},i=o([]),v=n=>{i.value=n},w=o([]);return{modalVisible:a,setModalVisible:p,urlModalVisible:l,setUrlModalVisible:b,knowledgeName:h,setKnowledgeName:f,fileList:i,setFileList:v,urlList:w,setUrlList:n=>{w.value=n},modalTitle:g,setModalTitle:U,$reset:()=>{a.value=!1,g.value=P.upload,h.value="",i.value=[],w.value=[]},getFileList:async n=>{try{const r=await I.fileList({kb_id:n});r.code==200&&(r.data.details.forEach(u=>{u.errorText=J(u)}),v(r.data.details))}catch(r){console.log(r),k.error(r.msg||ee.error)}}}}),{currentId:T}=W($()),le=E("option-list",()=>{const a=o([]),p=e=>{a.value=e},l=o({green:0,gray:0,yellow:0,red:0}),b=o(0),g=e=>{b.value=e},U=o(1),h=e=>{U.value=e},f=o(10),i=o([]),v=e=>{i.value=e},w=o(0),B=e=>{w.value=e},C=o(1),c=e=>{C.value=e},n=o(10),r=o(!1),u=e=>{r.value=e},m=o("upload"),Y=e=>{m.value=e},O=o(null),R=e=>{O.value=e},x=o(!1),Z=e=>{x.value=e},F=o(null),z=async()=>{F.value&&clearTimeout(F.value);const e=await Q(await I.fileList({kb_id:T.value,page_id:U.value,page_limit:f.value}));Object.keys(l.value).forEach(s=>{l.value[s]=0}),Object.assign(l.value,e.status_count),p([]),g(e.total);const L=(s="",d="green")=>d!=="green"?s:JSON.parse(s.toString());e==null||e.details.forEach((s,d)=>{a.value.push({id:1e4+d,fileId:s==null?void 0:s.file_id,fileIdName:s==null?void 0:s.file_name,status:s==null?void 0:s.status,bytes:G((s==null?void 0:s.bytes)||0),contentLength:s==null?void 0:s.content_length,createtime:V(s==null?void 0:s.timestamp),remark:(s==null?void 0:s.status)==="gray"?"":L(s==null?void 0:s.msg,s==null?void 0:s.status)})}),(e==null?void 0:e.details.some(s=>s.status==="gray"||s.status==="yellow"))?F.value=setTimeout(()=>{clearTimeout(F.value),z()},5e3):q()},q=()=>{let e=null;e=setInterval(async()=>{const L=await Q(await I.fileList({kb_id:T.value,page_id:1,page_limit:f.value}));Object.keys(l.value).forEach(t=>{l.value[t]=0}),Object.assign(l.value,L.status_count),g(L.total),l.value.gray===0&&l.value.yellow===0&&clearInterval(e)},5e3)},y=o(null),K=async()=>{try{y.value&&clearTimeout(y.value),u(!0);const e=await Q(await I.fileList({kb_id:T.value+"_FAQ",page_id:C.value,page_limit:n.value}));if(v([]),e!=null&&e.details)B(e.total);else{B(0),u(!1);return}for(const t of e==null?void 0:e.details){const s=e==null?void 0:e.details.indexOf(t);i.value.push({id:1e4+s,faqId:t==null?void 0:t.file_id,question:t==null?void 0:t.question,answer:t==null?void 0:t.answer,status:t==null?void 0:t.status,bytes:`${t==null?void 0:t.content_length}字符`,createtime:V(t==null?void 0:t.timestamp),picUrlList:[]}),t!=null&&t.picUrlList&&await H(t==null?void 0:t.picUrlList).then(d=>{console.log("成功获取图片文件:",d),i.value[s].picUrlList=t==null?void 0:t.picUrlList.map((A,N)=>({uid:-N,name:"image",status:"done",url:A,originFileObj:d[N]}))}).catch(d=>{console.error("获取图片文件出错:",d)})}(e==null?void 0:e.details.some(t=>t.status==="gray"||t.status==="yellow"))?(console.log("有解析中的  5s后再次请求"),y.value=setTimeout(()=>{clearTimeout(y.value),K()},5e3)):console.log("全部解析完成")}catch(e){console.log(e),k.error(e.msg||"获取faq列表失败")}u(!1)};function H(e){const L=e.map(t=>new Promise((s,d)=>{fetch(t).then(A=>A.blob()).then(A=>{const N=t.substring(t.lastIndexOf("/")+1),j=new File([A],N,{type:A.type});s(j)}).catch(A=>{console.error("Error fetching the image:",A),d(A)})}));return Promise.all(L)}return{dataSource:a,setDataSource:p,faqList:i,setFaqList:v,getDetails:z,timer:F,editQaSet:O,setEditQaSet:R,editModalVisible:x,setEditModalVisible:Z,faqTimer:y,getFaqList:K,faqType:m,setFaqType:Y,total:w,pageSize:n,setTotal:B,pageNum:C,setPageNum:c,loading:r,setLoading:u,totalStatus:l,kbTotal:b,kbPageSize:f,kbPageNum:U,setKbPageNum:h}},{persist:{storage:sessionStorage}}),ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",ce=E("useUploadFiles",()=>{const a=o([]),p=()=>{a.value=[]},l=o([]);return{uploadFileList:a,initUploadFileList:p,uploadFileListQuick:l,initUploadFileListQuick:()=>{l.value=[]}}});export{ne as _,oe as a,le as b,ce as c,_ as f,D as p,$ as u};
